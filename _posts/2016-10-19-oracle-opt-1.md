---
layout: post
title: oracle 优化
description:  
tag: [oracle, sql]
comments: true
categories: oralce
---

### 1. 单表查询

1.1 空值转换成实际值

```sql
select coalesce(col, value) from dual;
```
coalesce 比NVL高级，支持多个col, 如 coalesce(col1, col2, value);

1.2  case when 

```sql
SELECT T.SALARY, (CASE WHEN T.SALARY < 4000 THEN '4000-'
    WHEN T.SALARY < 5000 THEN '5000-'
   ELSE  
      '5000+'
   END ) LEVEL
FROM HR.EMPLOYEES T;
```
<!-- more -->

1.3 translate(expr, from_string, to_string) 

```sql
    select translate('ab 你好 bcadefg', 'abcdefg', '1234') from dual;
```

1.4 处理空值排序`nulls first`/`nulls last`

```sql
select t.employee_id, t.first_name, t.salary, t.manager_id 
from HR.EMPLOYEES t 
order by t.manager_id nulls first;
```

1.5 根据条件取不同列中的值来排序

```sql
select * from HR.EMPLOYEES t 
order by case when T.SALARY >= 3000 and t.salary < 1000 then 1 else 2 end, 3;
```

### 2. 操作多个表

2.1 union 去重

```sql
with e as (select rownum as sn, employee_id, email, job_id from HR.EMPLOYEES) 
select sn, EMPLOYEE_ID, email,job_id
from 
(
select sn, employee_id, email, job_id from e where E.JOB_ID='IT_PROG'
union 
select sn, employee_id, email, job_id from e where E.EMPLOYEE_ID='104'
)
order by 1;
```

